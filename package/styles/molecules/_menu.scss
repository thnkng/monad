// ============================================
// Menu Molecule - Context Menus & Dropdowns
// ============================================
// Enhanced styling for <menu> element in dropdown/context menu scenarios.
// Adds box-shadow and max-width for floating menus.
// For basic menus, use the <menu> atom instead.

@use "sass:color";
@use "../tokens/colors" as c;

// Dropdown/context menu wrapper (adds shadow and constraints)
menu.dropdown,
menu.context {
  box-shadow: var(--shadow-soft);
  max-width: 280px;
  position: absolute;
  z-index: 1000;
}

// Popover menu (triggered by dropdown/context actions)
menu[role="menu"] {
  box-shadow: var(--shadow-soft);
  max-width: 280px;
}

// Enhanced keyboard shortcut styling in dropdown menus
menu.dropdown button kbd,
menu.dropdown a kbd,
menu.context button kbd,
menu.context a kbd {
  margin-left: auto;
  font-size: var(--font-size-xsmall);
  opacity: 0.6;
  padding: var(--space-1) var(--space-2);
  background: var(--cloud-mist);
  border-radius: var(--radius-sm);
  font-family: var(--font-family-mono);
}

// Submenu indicator
menu.dropdown button.expandable::after,
menu.context button.expandable::after {
  content: "â€º";
  margin-left: auto;
  font-size: var(--font-size-large);
  opacity: 0.7;
}

// Nested submenu positioning
menu.dropdown menu,
menu.context menu {
  position: absolute;
  left: 100%;
  top: 0;
  margin-left: var(--space-1);
  display: none;
  
  &.visible {
    display: flex;
    animation: submenu-slide-in var(--motion-duration-fast) var(--motion-ease-decelerate);
  }
}

@keyframes submenu-slide-in {
  from {
    opacity: 0;
    transform: translateX(-8px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

// Helper mixin for color variants in dropdown context
@mixin menu-dropdown-variant($value) {
  border-color: color-mix(in srgb, $value 20%, var(--color-border));
  
  button.active,
  a.active {
    background-color: $value;
    color: var(--color-surface);
  }
  
  button.hoverable:hover:not(.active):not(.danger),
  a.hoverable:hover:not(.active):not(.danger) {
    background-color: color-mix(in srgb, $value 10%, var(--color-surface));
    color: $value;
  }
}

// Auto-generate color variants for dropdown menus
@each $palette, $entries in c.$colors {
  @each $name, $value in $entries {
    @if $name == default {
      menu.dropdown.#{"" + $palette},
      menu.context.#{"" + $palette} {
        @include menu-dropdown-variant($value);
      }
    } @else {
      menu.dropdown.#{"" + $palette}-#{$name},
      menu.context.#{"" + $palette}-#{$name} {
        @include menu-dropdown-variant($value);
      }
    }
  }
}

// Respect motion preferences
@media (prefers-reduced-motion: reduce) {
  menu.dropdown menu.visible,
  menu.context menu.visible {
    animation: none;
  }
}
